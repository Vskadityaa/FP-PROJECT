<!DOCTYPE html>
<html lang="en">
<head>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QR Code Generator</title>
    <link rel="stylesheet" href="petregister.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
</head>
<body>
  

    <div class="QrGeneration">
        <div class="Group40">
            <div class="Form">
                <div class="Address">
                    <label>Address</label>
                    <input type="text" id="address" class="Rectangle300">
                </div>
                <div class="Phone">
                    <label>Phone Number</label>
                    <input type="text" id="phone" class="Rectangle300">
                </div>
                <div class="Petname">
                    <label>Pet Name</label>
                    <input type="text" id="petName" class="Rectangle300">
                </div>
                <div class="Petbreed">
                    <label>Pet Breed</label>
                    <input type="text" id="petBreed" class="Rectangle300">
                </div>
                <div class="Ownername">
                    <label>Owner Name</label>
                    <input type="text" id="ownerName" class="Rectangle300">
                </div>
                <div class="Petcolor">
                    <label>Pet Colour</label>
                    <input type="text" id="petColor" class="Rectangle300">
                </div>
            </div>

            <div class="Createbutton">
                <button class="Button1" id="submit">Create QR Code</button>
            </div>

            <div id="qrcode"></div> <!-- QR Code will be generated here -->

            <div class="Footer">
                <p>Generate fully customized QR Codes, with colour & shape, logo and keep track of how many people scan your QR Codes, from where and on what date.</p>
            </div>

            <div class="DownloadButton">
                <button class="Button1" id="downloadQR" style="display:none;">DOWNLOAD</button>
            </div>

        </div>
    </div>

    <!-- Firebase & QR Code Generation Script -->
    <script type="module">
        // Import Firebase SDK modules
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-app.js";
        import { getDatabase, ref, set } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-database.js";


        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBHrBpHNePrpVG8Z5ahCY8Av8Y4A-6t9Ac",
            authDomain: "pet-registration-e9d6f.firebaseapp.com",
            databaseURL: "https://pet-registration-e9d6f-default-rtdb.firebaseio.com",
            projectId: "pet-registration-e9d6f",
            storageBucket: "pet-registration-e9d6f.appspot.com",
            messagingSenderId: "220116952151",
            appId: "1:220116952151:web:88565249899c7a60e9ef12"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // Function to generate a unique pet ID
        const generateUniqueId = () => {
            return "pet_" + new Date().getTime(); // Unique timestamp-based ID
        };

        // Event Listener for "Create QR Code" button
        document.getElementById("submit").addEventListener("click", function (e) {
            e.preventDefault();

            // Get input values
            const address = document.getElementById("address").value;
            const phone = document.getElementById("phone").value;
            const petName = document.getElementById("petName").value;
            const petBreed = document.getElementById("petBreed").value;
            const ownerName = document.getElementById("ownerName").value;
            const petColor = document.getElementById("petColor").value;

            // Validation: Ensure required fields are filled
            if (!petName || !ownerName || !phone) {
                alert("Pet Name, Owner Name, and Phone Number are required!");
                return;
            }

            // Generate a unique ID for the pet
            const petId = generateUniqueId();

            // Save pet details to Firebase Realtime Database
            set(ref(db, "pets/" + petId), {
                petId,
                address,
                phone,
                petName,
                petBreed,
                ownerName,
                petColor
            }).then(() => {
                alert("Pet Registered Successfully!");

                // Generate QR Code with stored data
                generateQRCode(petId, petName, ownerName, phone, petBreed, petColor, address);
            }).catch((error) => {
                console.error("Error saving pet data:", error);
                alert("Error registering pet!");
            });
        });

        // Function to generate QR Code
        const generateQRCode = (petId, petName, ownerName, phone, petBreed, petColor, address) => {
            const qrCodeContainer = document.getElementById("qrcode");

            // QR code content (without image)
            const qrData = `Pet ID: ${petId}
Owner: ${ownerName}
Phone: ${phone}
Pet Name: ${petName}
Breed: ${petBreed}
Color: ${petColor}
Address: ${address}`;

            // Clear old QR code
            qrCodeContainer.innerHTML = "";

            // Generate new QR Code
            new QRCode(qrCodeContainer, {
                text: qrData,
                width: 200,
                height: 200
            });

            // Enable download button
            document.getElementById("downloadQR").style.display = "block";
        };

        // Event Listener for QR Code Download
        document.getElementById("downloadQR").addEventListener("click", function () {
            const qrCodeCanvas = document.querySelector("#qrcode canvas");

            if (qrCodeCanvas) {
                const link = document.createElement("a");
                link.href = qrCodeCanvas.toDataURL("image/png");
                link.download = "Pet_QR_Code.png";
                link.click();
            } else {
                alert("Generate a QR code first!");
            }
        });
    </script>

</body>
</html>
